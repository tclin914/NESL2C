function cross_product(o,line) :((float,float),(float,float),(float,float)) ->float =
let (xo,yo) = o; 
    ((x1,y1),(x2,y2)) = line;
in (x1-xo)*(y2-yo) - (y1-yo)*(x2-xo);


function hsplit(points,p1,p2) :([(float, float)],(float,float),(float,float)) -> [(float,float)]=
let cross = {cross_product(p,(p1,p2)): p in points};
    packed = {p in points; c in cross | plusp(c)};
in if (#packed < 2) then [p1] ++ packed
   else
     let pm = points[max_index(cross)];
     in flatten({hsplit(packed,p1,p2): p1 in [p1,pm]; p2 in [pm,p2]});

function convex_hull(points) :([(float,float)])-> [(float,float)] = 
let x = {x : (x,y) in points};
    minx = points[min_index(x)];
    maxx = points[max_index(x)];
in hsplit(points,minx,maxx) ++ hsplit(points,maxx,minx);

a = 

%[(0.577531706541777, 0.808918898925185), (0.132396893575788, 0.664780270308256), (0.193760132417083, -0.457153089344501), (0.646589430049062, -0.130812283605337), (-0.209794523194432, -0.433589778840542), (0.340891022235155, -0.572124496102333), (0.0729183778166771, -0.934797713533044), (0.111098842695355, -0.0284529179334641), (-0.784120177850127, -0.451073693111539), (0.90958820655942, 0.216707015410066), (-0.484516302123666, -0.373283643275499), (0.459137890487909, 0.603777576237917)]; %

[(0.360750867053866, 0.603777576237917), (0.577531706541777, -0.480838213115931), (0.132396893575788, -0.564764792099595), (0.646589430049062, -0.126972379162908), (-0.209794523194432, -0.948270423337817), (0.340891022235155, 0.35644893720746), (0.0729183778166771, -0.549440670758486), (0.111098842695355, 0.18412647023797), (-0.784120177850127, -0.449790930375457), (-0.946396360173821, 0.170067137107253), (0.808918898925185, 0.0854307897388935), (-0.457153089344501, 0.0796553436666727), (-0.130812283605337, 0.600914487615228), (-0.433589778840542, 0.566117806360126), (-0.572124496102333, 0.133258983492851), (-0.0284529179334641, 0.230898078531027), (-0.451073693111539, 0.67610589414835), (0.216707015410066, -0.720978895202279), (-0.373283643275499, 0.797308299690485)];

convex_hull(a);


